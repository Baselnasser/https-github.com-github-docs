---
title: Использование сред для развертывания
shortTitle: Use environments for deployment
intro: 'Среды можно настроить с помощью правил защиты и секретов. Задание рабочего процесса, ссылающееся на среду, должно соответствовать любым правилам защиты среды перед запуском или доступом к секретам среды.'
product: '{% data reusables.gated-features.environments %}'
miniTocMaxHeadingLevel: 3
redirect_from:
  - /actions/reference/environments
  - /actions/deployment/environments
  - /actions/deployment/using-environments-for-deployment
versions:
  fpt: '*'
  ghes: '*'
  ghae: '*'
  ghec: '*'
ms.openlocfilehash: 21163a759cfd7eab3b197aeb4bb9283e1ccb90a2
ms.sourcegitcommit: 47bd0e48c7dba1dde49baff60bc1eddc91ab10c5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/05/2022
ms.locfileid: '147572306'
---
## Знакомство со средами

Среды используются для описания общего целевого объекта развертывания, такого как `production`, `staging` или `development`. Когда рабочий процесс {% data variables.product.prodname_actions %} выполняет развертывание в среде, эта среда отображается на главной странице репозитория. Дополнительные сведения о просмотре развертываний в средах см. в разделе [Просмотр журнала развертывания](/developers/overview/viewing-deployment-history).

Среды можно настроить с помощью правил защиты и секретов. Если задание рабочего процесса ссылается на среду, это задание не будет запускаться до тех пор, пока не будут выполнены все правила защиты среды. Задание также не может получить доступ к секретам, определенным в среде, до тех пор, пока не будут выполнены все правила защиты среды.

{% ifversion fpt %} {% note %}

**Примечание.** Вы можете настраивать среды только для общедоступных репозиториев. Если вы преобразуете репозиторий из общедоступного в частный, все настроенные правила защиты и секреты среды будут игнорироваться, и вы не сможете настроить какие-либо среды. Если вы преобразуете репозиторий обратно в общедоступный, то получите доступ ко всем ранее настроенным правилам защиты и секретам среды.

Организации с {% data variables.product.prodname_team %} и пользователи с {% data variables.product.prodname_pro %} могут настраивать среды для частных репозиториев. Дополнительные сведения см. в разделе [Продукты {% data variables.product.prodname_dotcom %}](/get-started/learning-about-github/githubs-products).

{% endnote %} {% endif %}

## Правила защиты среды

Правила защиты среды требуют выполнения определенных условий, прежде чем задание, ссылающееся на среду, сможет продолжить работу. Вы можете использовать правила защиты среды, чтобы требовать утверждения вручную, откладывать задания или ограничивать среду определенными ветвями.

### Обязательные рецензенты

С помощью обязательных рецензентов вы можете требовать, чтобы задания рабочего процесса, ссылающиеся на среду, утверждались конкретным пользователем или командой. Вы можете перечислить до шести пользователей или групп в качестве рецензентов. Рецензенты должны иметь по крайней мере доступ на чтение в репозитории. Только один из обязательных рецензентов должен утвердить задание, чтобы оно могло продолжить работу.

Дополнительные сведения о проверке обязательными рецензентами заданий, ссылающихся на среду, см. в разделе [Проверка развертываний](/actions/managing-workflow-runs/reviewing-deployments).

### Таймер ожидания

Таймер ожидания можно использовать для задержки задания на определенный промежуток времени после первоначальной активации задания. Время указывается в минутах и должно быть целым числом от 0 до 43 200 (30 дней).

### Ветви развертывания

С помощью ветвей развертывания можно ограничить ветви, которые могут развертываться в среде. Ниже приведены варианты ветвей развертывания для среды.

* **Все ветви**. Все ветви в репозитории могут развертываться в среде.
* **Защищенные ветви**. В среде могут развертываться только ветви с включенными правилами защиты ветвей. Если правила защиты ветви не определены ни для одной ветви в репозитории, то могут развертываться все ветви. Дополнительные сведения о правилах защиты ветви см. в разделе [Сведения о защищенных ветвях](/github/administering-a-repository/about-protected-branches).
* **Выбранные ветви**. В среде могут развертываться только ветви, чьи имена соответствуют указанным шаблонам имен.

  Например, если вы указываете правило ветви развертывания `releases/*`, в среде могут развертываться только ветви, имена которых начинаются с `releases/`. (Подстановочные знаки не будут сопоставляться с `/`. Чтобы сопоставить ветви, начинающиеся с `release/` и содержащие дополнительную косую черту, используйте `release/*/*`.) Если вы добавите `main` в качестве правила ветви развертывания, ветвь с именем `main` также может быть развернута в среде. Дополнительные сведения о параметрах синтаксиса для ветвей развертывания см. в [документации Ruby File.fnmatch](https://ruby-doc.org/core-2.5.1/File.html#method-c-fnmatch).
## Секреты среды

Секреты, хранящиеся в среде, доступны только заданиям рабочих процессов, ссылающимся на среду. Если среда требует утверждения, задание не сможет получить доступ к секретам среды, пока один из обязательных рецензентов не утвердит его. Дополнительные сведения о секретах см. в разделе [Зашифрованные секреты](/actions/reference/encrypted-secrets).

{% note %}

**Примечание.** Рабочие процессы, запускаемые в локальных средствах выполнения, не выполняются в изолированном контейнере, даже если они используют среды. Секреты среды должны находиться на том же уровне безопасности, что и секреты репозитория и организации. Дополнительные сведения см. в разделе [Усиление безопасности для GitHub Actions](/actions/learn-github-actions/security-hardening-for-github-actions#hardening-for-self-hosted-runners).

{% endnote %}

## Создание среды

{% data reusables.actions.permissions-statement-environment %}

{% ifversion fpt or ghec %} {% note %}

**Примечание.** Возможность создания среды в частном репозитории доступна организациям с {% data variables.product.prodname_team %} и пользователям с {% data variables.product.prodname_pro %}.

{% endnote %} {% endif %}

{% data reusables.repositories.navigate-to-repo %} {% data reusables.repositories.sidebar-settings %} {% data reusables.actions.sidebar-environment %} {% data reusables.actions.new-environment %} {% data reusables.actions.name-environment %}
1. При необходимости укажите пользователей или команды, которые должны утверждать задания рабочих процессов, использующие эту среду.
   1. Выберите **Обязательные рецензенты**.
   1. Введите до 6 пользователей или команд. Только один из обязательных рецензентов должен утвердить задание, чтобы оно могло продолжить работу.
   1. Нажмите **Сохранить правила защиты**.
2. При необходимости укажите время ожидания до разрешения заданиям рабочего процесса, использующим эту среду, продолжить работу.
   1. Выберите **Таймер ожидания**.
   1. Введите количество минут ожидания.
   1. Нажмите **Сохранить правила защиты**.
3. При необходимости укажите, какие ветви можно развернуть в этой среде. Дополнительные сведения о возможных значениях см. в разделе [Ветви развертывания](#deployment-branches).
   1. Выберите нужный вариант в раскрывающемся списке **Ветви развертывания**.
   1. Если вы указываете **Выбранные ветви**, введите шаблоны имен ветвей, которые хотите разрешить.
4. При необходимости добавьте секреты среды. Эти секреты доступны только для заданий рабочих процессов, использующих данную среду. Кроме того, задания рабочих процессов, использующие эту среду, могут получить доступ к этим секретам только после выполнения всех настроенных правил (например, обязательных рецензентов). Дополнительные сведения о секретах см. в разделе [Зашифрованные секреты](/actions/reference/encrypted-secrets).
   1. В разделе **Секреты среды** нажмите **Добавить секрет**.
   1. Введите имя секрета.
   1. Введите значение секрета.
   1. Щелкните **Добавить секрет**.

Вы также можете создавать и настраивать среды с помощью REST API. Дополнительные сведения см. в разделах "[Среды развертывания](/rest/deployments/environments)", "[Секреты GitHub Actions](/rest/actions/secrets)" и "[Политики ветви развертывания](/rest/deployments/branch-policies)".

При запуске рабочего процесса, ссылающегося на среду, которая не существует, будет создана среда с указанным именем. В этой только что созданной среде не будет настроенных правил защиты или секретов. Любой пользователь, который может изменять рабочие процессы в репозитории, может создавать среды с помощью файла рабочего процесса, но настраивать среду могут только администраторы репозитория.

## Использование среды

Каждое задание в рабочем процессе может ссылаться на одну среду. Чтобы задание, ссылающееся на среду, было отправлено в средство выполнения, должны быть выполнены все правила защиты среды. Задание может получить доступ к секретам среды только после отправки задания в средство выполнения.

Если рабочий процесс ссылается на среду, среда будет отображаться в развертываниях репозитория. Дополнительные сведения о просмотре текущих и предыдущих развертываний см. в разделе [Просмотр журнала развертывания](/developers/overview/viewing-deployment-history).

{% data reusables.actions.environment-example %}

## Удаление среды

{% data reusables.actions.permissions-statement-environment %}

При удалении среды будут удалены все секреты и правила защиты, связанные с этой средой. Все задания из удаленной среды, находившиеся в состоянии ожидания из-за правил защиты, автоматически завершатся с ошибкой.

{% data reusables.repositories.navigate-to-repo %} {% data reusables.repositories.sidebar-settings %} {% data reusables.actions.sidebar-environment %}
1. Щелкните {% octicon "trash" aria-label="The trash icon" %} рядом со средой, которую хотите удалить.
2. Нажмите **"Я понимаю, удалить эту среду**.

Вы также можете удалить среды с помощью REST API. Дополнительные сведения: [Среды](/rest/reference/repos#environments).

## Связь сред с развертываниями

{% data reusables.actions.environment-deployment-event %}

Вы можете получить доступ к этим объектам с помощью REST API или API GraphQL. Вы также можете подписаться на эти события веб-перехватчика. Дополнительные сведения см. в разделе [Репозитории](/rest/reference/repos#deployments) (REST API), [Объекты](/graphql/reference/objects#deployment) (API GraphQL) или [События и полезные данные веб-перехватчика](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#deployment).

## Дальнейшие действия

{% data variables.product.prodname_actions %} предоставляет несколько функций для управления развертываниями. Дополнительные сведения см. в разделе [Развертывание с помощью GitHub Actions](/actions/deployment/deploying-with-github-actions).
