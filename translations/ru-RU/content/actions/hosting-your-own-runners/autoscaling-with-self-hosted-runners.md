---
title: Автомасштабирование с помощью локальных средств выполнения
shortTitle: Autoscale self-hosted runners
intro: Вы можете автоматически масштабировать локальные средства выполнения тестов в ответ на события веб-перехватчика.
versions:
  fpt: '*'
  ghec: '*'
  ghes: '*'
  ghae: '*'
type: overview
ms.openlocfilehash: 2fe0c197ac122ea9cd976c2718a492bd80c073fe
ms.sourcegitcommit: f638d569cd4f0dd6d0fb967818267992c0499110
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/25/2022
ms.locfileid: '148107560'
---
{% data reusables.actions.enterprise-beta %} {% data reusables.actions.enterprise-github-hosted-runners %}

## Сведения об автомасштабировании

Вы можете автоматически увеличивать или уменьшать количество локальных средств выполнения в вашей среде в ответ на полученные события веб-перехватчика с определенной меткой. Например, можно создать автоматизацию, которая добавляет новое локальное средство выполнения при каждом получении события веб-перехватчика [`workflow_job`](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#workflow_job) с действием [`queued`](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#workflow_job), которое уведомляет о готовности нового задания к обработке. Полезные данные веб-перехватчика содержат данные метки, поэтому вы можете определить тип средства выполнения, который запрашивает задание. После завершения задания можно создать автоматизацию, которая удаляет средство выполнения в ответ на действие `workflow_job` [`completed`](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#workflow_job). 

## Рекомендуемые решения автомасштабирования

{% data variables.product.prodname_dotcom %} тесно сотрудничает с двумя проектами открытого кода, которые рекомендуется использовать для автомасштабирования средств выполнения. В зависимости от ваших потребностей вам может подойти одно или оба решения. 

Следующие репозитории содержат подробные инструкции по настройке этих средств автомасштабирования. 

- [actions-runner-controller/actions-runner-controller](https://github.com/actions-runner-controller/actions-runner-controller) — контроллер Kubernetes для локальных средств выполнения {% data variables.product.prodname_actions %}.
- [philips-labs/terraform-aws-github-runner](https://github.com/philips-labs/terraform-aws-github-runner) — модуль Terraform для масштабируемых средств выполнения {% data variables.product.prodname_actions %} в Amazon Web Services.

Каждое решение имеет определенные особенности, которые важно учитывать.

| **Функции** | **actions-runner-controller** | **terraform-aws-github-runner** |
| :--- | :--- | :--- |
| Параметры выполнения | Kubernetes | Виртуальные машины Linux и Windows |
| Поддерживаемые облака | Azure, Amazon Web Services, Google Cloud Platform, локальная среда | Amazon Web Services |
| Где можно масштабировать средства выполнения | Уровни предприятия, организации и репозитория. По метке и по группе средства выполнения. | Уровни организации и репозитория. По метке и по группе средства выполнения. |
| Как можно масштабировать средства выполнения | События веб-перехватчика, по расписанию, по запросу | События веб-перехватчика, по расписанию (только средства выполнения на уровне организации) |

## Использование временных средств выполнения для автомасштабирования

{% data variables.product.prodname_dotcom %} рекомендует реализовать автомасштабирование с помощью временных локальных средств выполнения. Автомасштабирование с постоянными локальными средствами выполнения не рекомендуется. В некоторых случаях {% data variables.product.prodname_dotcom %} не может гарантировать, что задания не назначаются постоянным средствам выполнения, которые завершили работу. При использовании временных средств выполнения это может быть гарантировано, так как {% data variables.product.prodname_dotcom %} назначает средству выполнения только одно задание.

Такой подход позволяет управлять средствами выполнения как временными системами, так как вы можете использовать автоматизацию для обеспечения новой среды для каждого задания. Это помогает ограничить уязвимость любых конфиденциальных ресурсов из предыдущих заданий, а также снизить риск получения новых заданий скомпрометированным средством выполнения.  

Чтобы добавить в вашу среду временное средство выполнения, включите параметр `--ephemeral` при регистрации средства выполнения с помощью `config.sh`. Пример:

```shell
./config.sh --url https://github.com/octo-org --token example-token --ephemeral
```

Служба {% data variables.product.prodname_actions %} автоматически отменяет регистрацию средства выполнения после обработки одного задания. Затем вы можете создать собственную автоматизацию, которая очищает средство выполнения после отмены его регистрации.

{% note %}

**Примечание.** Если задание помечено для средств выполнения определенного типа, но ни одно из них недоступно, задание в очереди не сразу завершается сбоем. Оно будет оставаться в очереди до истечения 24-часового периода ожидания.

{% endnote %}

{% ifversion fpt или ghec или ghes > 3.4 или ghae %}

## Управление обновлениями программного обеспечения на локальных средствах выполнения

По умолчанию локальные средства выполнения будут автоматически выполнять обновление программного обеспечения каждый раз, когда становится доступной новая версия программного обеспечения средства выполнения.  Если в контейнерах используются временные средства выполнения, это может привести к неоднократным обновлениям программного обеспечения при выпуске новой версии средства выполнения.  Отключение автоматических обновлений позволяет обновлять версию средства выполнения в образе контейнера напрямую по собственному расписанию.

Чтобы отключить автоматическое обновление программного обеспечения и устанавливать обновления программного обеспечения самостоятельно, укажите флаг `--disableupdate` при регистрации средства выполнения с помощью `config.sh`. Пример:

```shell
./config.sh --url https://github.com/YOUR-ORGANIZATION --token EXAMPLE-TOKEN --disableupdate
```

Если автоматические обновления отключены, необходимо регулярно обновлять версию средства выполнения.  Для использования новых функциональных возможностей в {% data variables.product.prodname_actions %} требуются изменения как в службе {% data variables.product.prodname_actions %}, _так и_ в программном обеспечении средства выполнения.  Средство выполнения не сможет правильно обрабатывать задания, использующие новые функции в {% data variables.product.prodname_actions %}, без обновления программного обеспечения.

Если вы отключаете автоматическое обновление, то должны будете обновлять версию средства выполнения в течение 30 дней после того, как станет доступной новая версия.  Вы можете подписаться на уведомления о выпусках в [репозитории`actions/runner`](https://github.com/actions/runner/releases). Дополнительные сведения см. в разделе [Настройка уведомлений](/account-and-profile/managing-subscriptions-and-notifications-on-github/setting-up-notifications/configuring-notifications#about-custom-notifications).

Инструкции по установке последней версии средства выполнения см. в инструкциях по установке [последнего выпуска](https://github.com/actions/runner/releases).

{% note %}

**Примечание.** Если вы не выполните обновление программного обеспечения в течение 30 дней, служба {% data variables.product.prodname_actions %} не будет помещать задания в очередь для вашего средства выполнения.  Кроме того, если требуется критическое обновление системы безопасности, служба {% data variables.product.prodname_actions %} не будет помещать задания в очередь для вашего средства выполнения до его обновления.

{% endnote %}

{% endif %}

## Использование веб-перехватчиков для автомасштабирования

Вы можете создать собственную среду автомасштабирования с помощью полезных данных, полученных от веб-перехватчика [`workflow_job`](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#workflow_job). Этот веб-перехватчик доступен на уровне репозитория, организации и предприятия, а полезные данные для этого события содержат ключ `action`, соответствующий этапам жизненного цикла задания рабочего процесса, например, когда задания `queued`, `in_progress` и `completed`. Затем вы должны создать собственную автоматизацию масштабирования в ответ на эти полезные данные веб-перехватчика.

- Дополнительные сведения о веб-перехватчике `workflow_job` см. в разделе [События и полезные данные веб-перехватчика](/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#workflow_job).
- Сведения о том, как работать с веб-перехватчиками, см. в разделе [Создание веб-перехватчиков](/developers/webhooks-and-events/webhooks/creating-webhooks).

## Требования к проверке подлинности

Вы можете регистрировать и удалять репозиторий и локальные средства выполнения организации с помощью [API](/rest/reference/actions#self-hosted-runners). Для проверки подлинности в API в вашей реализации автомасштабирования может использоваться маркер доступа или приложение {% data variables.product.prodname_dotcom %}. 

Для маркера доступа потребуется следующая область.

- Для частных репозиториев используйте маркер доступа с [областью`repo`](/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes).
- Для общедоступных репозиториев используйте маркер доступа с [областью`public_repo`](/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes).
- Для организаций используйте маркер доступа с [областью`admin:org`](/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes).

Для проверки подлинности с помощью приложения {% data variables.product.prodname_dotcom %} необходимо назначить следующие разрешения.
- Для репозиториев назначьте разрешение `administration`.
- Для организаций назначьте разрешение `organization_self_hosted_runners`.

Вы можете регистрировать и удалять локальные средства выполнения предприятия с помощью [API](/rest/reference/actions#self-hosted-runners). Для проверки подлинности в API в вашей реализации автомасштабирования может использоваться маркер доступа.

Для маркера доступа потребуется область `manage_runners:enterprise`.
