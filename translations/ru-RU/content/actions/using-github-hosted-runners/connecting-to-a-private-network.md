---
title: Подключение к частной сети
shortTitle: Connect to a private network
intro: 'Вы можете подключить средства выполнения тестов, размещенные в {% data variables.product.prodname_dotcom %}, к ресурсам в частной сети, включая реестры пакетов, диспетчеры секретов и другие локальные службы.'
versions:
  fpt: '*'
  ghes: '*'
  ghec: '*'
type: how_to
topics:
  - Actions
  - Developer
ms.openlocfilehash: d593369c1f1455d1f5cf766e5983eb4f010ec064
ms.sourcegitcommit: 7b86410fc3bc9fecf0cb71dda4c7d2f0da745b85
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/05/2022
ms.locfileid: '148010072'
---
{% data reusables.actions.enterprise-beta %} {% data reusables.actions.enterprise-github-hosted-runners %}

## Сведения о средствах выполнения тестов, размещенных в {% data variables.product.prodname_dotcom %}

По умолчанию средства выполнения тестов, размещенные в {% data variables.product.prodname_dotcom %}, имеют доступ к общедоступному Интернету. Однако эти средства выполнения тестов также могут получить доступ к ресурсам в частной сети, например к реестру пакетов, диспетчеру секретов или другим локальным службам. 

Средства выполнения тестов, размещенные в {% data variables.product.prodname_dotcom %}, используются совместно всеми клиентами {% data variables.product.prodname_dotcom %}, поэтому вам потребуется способ подключения частной сети только к вашим средствам выполнения сети во время выполнения ими рабочих процессов. Существует несколько различных подходов, которые можно использовать для настройки этого доступа, каждый из которых имеет различные преимущества и недостатки.

{% ifversion fpt or ghec or ghes > 3.4 %}
### Использование шлюза API с OIDC

С помощью {% data variables.product.prodname_actions %} можно использовать маркеры OpenID Connect (OIDC) для проверки подлинности рабочего процесса за пределами {% data variables.product.prodname_actions %}. Например, можно запустить шлюз API на границе частной сети, который проверяет подлинность входящих запросов с помощью маркера OIDC, а затем отправляет запросы API от имени рабочего процесса в частную сеть.

На следующей схеме представлен обзор архитектуры этого решения:

![Схема шлюза OIDC](/assets/images/help/images/actions-oidc-gateway.png)

Важно проверить подлинность не только того, что маркер OIDC получен из {% data variables.product.prodname_actions %}, но и то, что он получен конкретно от ожидаемых рабочих процессов, чтобы другие пользователи {% data variables.product.prodname_actions %} не могли получить доступ к службам в частной сети. Для создания этих условий можно использовать утверждения OIDC. Дополнительные сведения см. в разделе [Определение условий доверия для облачных ролей с помощью утверждений OIDC](/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#defining-trust-conditions-on-cloud-roles-using-oidc-claims).

Основным недостатком этого подхода является реализация шлюза API для выполнения запросов от вашего имени, а также его запуска на границе сети.

Но есть также и преимущества:
- вам не нужно настраивать брандмауэры или изменять маршрутизацию частной сети; 
- шлюз API без отслеживания состояния, поэтому масштабируется горизонтально для обработки высокого уровня доступности и высокой пропускной способности.

Дополнительные сведения см. в [справочной реализации шлюза API](https://github.com/github/actions-oidc-gateway-example) (обратите внимание, что для этого требуется настроить ваш вариант использования и данная реализация не готова к запуску как есть) и в разделе [Сведения о защите безопасности с помощью OpenID Connect](/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect).
{% endif %}

### Создание наложения сети с помощью WireGuard

Если вы не хотите создавать отдельную инфраструктуру для шлюза API, можно создать сеть наложения между средством выполнения тестов и службой в частной сети, запустив WireGuard в обоих местах.

У этого подхода есть несколько недостатков. 

- Чтобы подключиться к WireGuard, работающей в частной службе, потребуется известные IP-адрес и порт, на которые может ссылаться рабочий процесс: это может быть общедоступные IP-адрес и порт, сопоставление портов в сетевом шлюзе или служба, которая динамически обновляет DNS. 
- В WireGuard отсутствует встроенная функция обработки обхода NAT, поэтому вам потребуется определить способ предоставления этой службы.
- Это подключение "один к одному", поэтому, если требуется высокий уровень доступности или высокая пропускная способность, необходимо создать это на основе WireGuard. 
- Вам потребуется создать и безопасно хранить ключи для средства выполнения тестов и частной службы. WireGuard использует UDP, поэтому ваша сеть должна поддерживать трафик UDP.

Однако имеются и преимущества, например, вы можете запустить WireGuard на существующем сервере, поэтому вам не нужна отдельная инфраструктура, и она хорошо поддерживается средствами выполнения тестов, размещенными в {% data variables.product.prodname_dotcom %}.

### Пример. Настройка WireGuard

В этом примере рабочий процесс настраивает WireGuard для подключения к частной службе.

В этом примере экземпляр WireGuard, запущенный в частной сети, имеет следующую конфигурацию:
- IP-адрес сети наложения `192.168.1.1`
- Общедоступный IP-адрес и порт `1.2.3.4:56789`
- Открытый ключ `examplepubkey1234...`

Экземпляр WireGuard в средстве выполнения тестов {% data variables.product.prodname_actions %} имеет следующую конфигурацию:
- IP-адрес сети наложения `192.168.1.2`
- Закрытые ключи хранятся в виде секрета{% data variables.product.prodname_actions %} в `WIREGUARD_PRIVATE_KEY`

```yaml
name: WireGuard example

on:
  workflow_dispatch:

jobs:
  wireguard_example:
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt install wireguard

      - run: echo "${{ secrets.WIREGUARD_PRIVATE_KEY }}" > privatekey

      - run: sudo ip link add dev wg0 type wireguard

      - run: sudo ip address add dev wg0 192.168.1.2 peer 192.168.1.1

      - run: sudo wg set wg0 listen-port 48123 private-key privatekey peer examplepubkey1234... allowed-ips 0.0.0.0/0 endpoint 1.2.3.4:56789

      - run: sudo ip link set up dev wg0

      - run: curl -vvv http://192.168.1.1
```

Дополнительные сведения см. [в кратком руководстве по WireGuard](https://www.wireguard.com/quickstart/), а также в разделе [Зашифрованные секреты](/actions/security-guides/encrypted-secrets), чтобы узнать, как безопасно хранить ключи.

### Использование Tailscale для создания наложения сети

Tailscale — это коммерческий продукт на базе WireGuard. Данный вариант очень похож на WireGuard, за исключением того, что Tailscale является более полноценным продуктом, а не компонентом с открытым кодом.

Недостатки аналогичны WireGuard: подключение "один к одному", поэтому может потребоваться дополнительная работа для обеспечения высокого уровня доступности или высокой пропускной способности. Вам по-прежнему придется создавать ключи и безопасно хранить их. Протокол по-прежнему UDP, поэтому ваша сеть должна поддерживать трафик UDP.

Тем не менее, есть некоторые преимущества по сравнению с WireGuard: функция обхода NAT является встроенной, поэтому вам не нужно предоставлять порт для подключения к общедоступному Интернету. На сегодняшний день это самый быстрый из обсуждаемых вариантов, поскольку Tailscale предоставляет рабочий процесс {% data variables.product.prodname_actions %} с одним шагом для подключения к сети наложения.

Дополнительные сведения см. в разделе [Tailscale GitHub Action](https://github.com/tailscale/github-action), а также в разделе [Зашифрованные секреты](/actions/security-guides/encrypted-secrets), чтобы узнать о безопасном хранении ключей.
