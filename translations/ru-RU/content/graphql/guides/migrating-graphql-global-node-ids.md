---
title: Перенос глобальных идентификаторов узлов GraphQL
intro: 'Изучите два глобальных формата идентификаторов узлов и узнайте о том, как перейти из устаревшего формата в новый.'
versions:
  fpt: '*'
  ghec: '*'
topics:
  - API
shortTitle: Migrating global node IDs
ms.openlocfilehash: 7d62d81e52b848e4fb8b5f6b2bae9997e0ac1209
ms.sourcegitcommit: 478f2931167988096ae6478a257f492ecaa11794
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2022
ms.locfileid: '147717856'
---
## Историческая справка

API GraphQL для {% data variables.product.product_name %} в настоящее время поддерживает два формата глобальных идентификаторов узлов. Старый формат станет нерекомендуемым и будет заменен новым форматом.  В этом руководстве показано, как при необходимости перейти на новый формат. 

Переходя на новый формат, вы обеспечиваете стабильно малое время отклика на запросы. Вы также гарантируете, что приложение продолжит работать после окончательного упразднения старых идентификаторов.

Дополнительные сведения о причинах упразднения старого формата глобальных идентификаторов узлов см. в разделе [Новый формат глобальных идентификаторов в GraphQL](https://github.blog/2021-02-10-new-global-id-format-coming-to-graphql).

## Определение необходимости принятия мер

Выполнить инструкции по переходу необходимо только в том случае, если вы храните ссылки на глобальные идентификаторы узлов GraphQL.  Эти идентификаторы соответствуют полю `id` для любого объекта в схеме.  Если вы не храните глобальные идентификаторы узлов, то можете продолжать работать с API как прежде.

Кроме того, если в настоящее время вы декодируете старые идентификаторы для извлечения сведений о типах (например, если вы используете первые два символа `PR_kwDOAHz1OX4uYAah` для определения того, является ли объект запросом на вытягивание), работа службы нарушится из-за изменения формата идентификаторов.  Необходимо перенести службу для обработки этих идентификаторов как непрозрачных строк.  Эти идентификаторы будут уникальными, поэтому их можно использовать как ссылки напрямую.


## Переход на новые глобальные идентификаторы

Чтобы упростить переход на новый формат идентификаторов, можно использовать заголовок `X-Github-Next-Global-ID` в запросах API GraphQL. Заголовок `X-Github-Next-Global-ID` может иметь значение `1` или `0`.  Если задать значение `1`, в полезных данных ответа всегда будет использоваться новый формат идентификаторов для любого объекта, для которого запрашивается поле `id`.  Если задать значение `0`, восстанавливается поведение по умолчанию, то есть отображается устаревший или новый идентификатор в зависимости от даты создания объекта. 

Вот пример запроса с использованием cURL:

```
$ curl \
  -H "Authorization: Bearer $GITHUB_TOKEN" \
  -H "X-Github-Next-Global-ID: 1" \
  https://api.github.com/graphql \
  -d '{ "query": "{ node(id: \"MDQ6VXNlcjM0MDczMDM=\") { id } }" }'
```

Несмотря на то, что в запросе использовался устаревший идентификатор `MDQ6VXNlcjM0MDczMDM=`, ответ будет содержать идентификатор в новом формате:
```
{"data":{"node":{"id":"U_kgDOADP9xw"}}}
```
С помощью заголовка `X-Github-Next-Global-ID` можно определить новый формат для устаревших идентификаторов, на которые вы ссылаетесь в приложении. Затем можно обновить эти ссылки идентификатором, полученным в ответе. Необходимо обновить все ссылки на устаревшие идентификаторы и использовать новый формат идентификаторов во всех последующих запросах к API. Для выполнения массовых операций можно использовать псевдонимы. Они позволяют отправлять запросы к нескольким узлам в одном вызове API. Дополнительные сведения см. в [документации по GraphQL](https://graphql.org/learn/queries/#aliases).

Вы также можете получить новый идентификатор для коллекции элементов. Например, если нужно получить новый идентификатор для последних 10 репозиториев в организации, можно использовать следующий запрос:
```
{
  organization(login: "github") {
    repositories(last: 10) {
      edges {
        cursor
        node {
          name
          id
        }
      }
    }
  }
}
```

Обратите внимание, что присвоение значения `1` заголовку `X-Github-Next-Global-ID` повлияет на возвращаемое значение каждого поля `id` в запросе.  Это означает, что даже при отправке запроса, не относящегося к `node`, будет возвращен новый формат идентификаторов, если вы запросили поле `id`.

## Отправка отзывов

Если вы беспокоитесь о том, что развертывание этого изменения может повлиять на ваше приложение, [обратитесь в {% data variables.product.product_name %}](https://support.github.com/contact) и сообщите дополнительные сведения, например имя приложения, чтобы нам было проще помочь вам.
