---
title: Настройка предварительных сборок
shortTitle: Configure prebuilds
intro: Вы можете настроить проект для автоматической предварительной сборки пространства кода при каждой отправке изменений в репозиторий.
versions:
  fpt: '*'
  ghec: '*'
type: how_to
topics:
  - Codespaces
  - Set up
permissions: People with admin access to a repository can configure prebuilds for the repository.
ms.openlocfilehash: dbb355e150695f27d1d6a7fa51eccc33a0ebde4f
ms.sourcegitcommit: e8c012864f13f9146e53fcb0699e2928c949ffa8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/09/2022
ms.locfileid: '148159120'
---
Можно настроить конфигурацию предварительной сборки для определенной ветви репозитория в сочетании с определенным файлом конфигурации контейнера разработки.

Все ветви, созданные из родительской ветви с поддержкой предварительных сборок, обычно также получают предварительные сборки для той же конфигурации контейнера разработки. Это связано с тем, что предварительные сборки для дочерних ветвей, которые используют ту же конфигурацию контейнера разработки, что и родительская ветвь, по большей части идентичны, поэтому разработчики могут воспользоваться более быстрым временем создания codespace в этих ветвях. Дополнительные сведения см. в статье [Общие сведения о контейнерах разработки](/codespaces/setting-up-your-project-for-codespaces/introduction-to-dev-containers).

Обычно при настройке предварительных сборок для ветви они доступны для различных типов компьютеров. Однако если в репозитории больше 32 ГБ, предварительные сборки не будут доступны для двух- и четырехъядерных компьютеров, так как хранилище ограничено 32 ГБ.

## Предварительные требования 

Предварительные сборки создаются с помощью {% data variables.product.prodname_actions %}. В результате для репозитория, для которого настраиваются предварительные сборки, необходимо включить {% data variables.product.prodname_actions %}. Дополнительные сведения см. в разделе [Управление параметрами {% data variables.product.prodname_actions %} для репозитория](/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-github-actions-settings-for-a-repository).

## Настройка предварительных сборок

{% data reusables.codespaces.accessing-prebuild-configuration %}
1. В разделе "Конфигурация предварительной сборки" выберите **Настроить предварительную сборку**.

   ![Кнопка "Настройка предварительных сборки"](/assets/images/help/codespaces/prebuilds-set-up.png)

1. Выберите ветвь, для которой требуется настроить предварительные сборки.

   ![Раскрывающееся меню ветви](/assets/images/help/codespaces/prebuilds-choose-branch.png)

   {% note %} 

   **Примечание.** Все ветви, созданные из базовой ветви с поддержкой предварительных сборок, обычно также получают предварительные сборки для той же конфигурации контейнера разработки. Например, если включить предварительные сборки для файла конфигурации контейнера разработки для ветви репозитория по умолчанию, в большинстве случаев ветви на основе ветви по умолчанию также получат предварительные сборки для той же конфигурации контейнера разработки.

   {% endnote %}

1. При необходимости в раскрывающемся меню **Файл конфигурации** выберите `devcontainer.json` файл конфигурации, который вы хотите использовать для предварительных сборок. Дополнительные сведения см. в статье [Общие сведения о контейнерах разработки](/codespaces/setting-up-your-project-for-codespaces/introduction-to-dev-containers#devcontainerjson).

   ![Раскрывающееся меню файла конфигурации](/assets/images/help/codespaces/prebuilds-choose-configfile.png)

1. Выберите способ автоматического запуска обновлений предварительной сборки.

   * **Каждая отправка** (параметр по умолчанию) — при использовании этого параметра предварительные сборки будут обновляться при каждой отправке, выполненной в указанную ветвь. Это гарантирует, что пространства кода, созданные из предварительной сборки, всегда будут содержать последнюю конфигурацию пространства кода, включая все недавно добавленные или обновленные зависимости.
   * **При изменении конфигурации** — с помощью этого параметра предварительные сборки будут обновляться при каждом обновлении связанных файлов конфигурации для заданного репозитория и ветви. Это гарантирует, что изменения в файлах конфигурации контейнера разработки для репозитория используются при создании пространства кода из предварительной сборки. Рабочий процесс {% data variables.product.prodname_actions %}, который обновляет предварительные сборки, будет выполняться реже, поэтому этот параметр будет использовать меньше {% data variables.product.prodname_actions %} минут. Однако этот вариант не гарантирует, что пространства кода всегда содержат недавно добавленные или обновленные зависимости, поэтому их может потребоваться добавить или обновить вручную после создания пространства кода.
   * **Запланировано** . С помощью этого параметра предварительные сборки можно обновлять по пользовательскому расписанию, определенному вами. Это может снизить потребление {% data variables.product.prodname_actions %} минут, однако при использовании этого параметра можно создавать пространства кода, которые не используют последние изменения конфигурации контейнера разработки.

   ![Параметры триггера предварительной сборки](/assets/images/help/codespaces/prebuilds-triggers.png)

1. При необходимости выберите **Уменьшить доступность предварительной сборки только для определенных регионов** , чтобы создавать предварительные сборки только в указанных регионах. Выберите регионы, в которых должны быть доступны предварительные сборки.

   По умолчанию предварительные сборки создаются во всех доступных регионах, что влечет за собой плату за хранение для каждой предварительной сборки.

   ![Параметры выбора региона](/assets/images/help/codespaces/prebuilds-regions.png)

   {% note %}

   **Примечания** 
   * За предварительную сборку в каждом регионе взимается отдельная плата за хранение. Поэтому следует включить предварительные сборки только для регионов, где они точно будут использоваться. Дополнительные сведения см. в статье [Сведения о выставлении счетов за {% data variables.product.prodname_github_codespaces %}](/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces#billing-for-codespaces-prebuilds).
   * Разработчики могут задать регион по умолчанию для {% data variables.product.prodname_github_codespaces %}, что позволяет включить предварительные сборки для меньшего числа регионов. Дополнительные сведения см. в разделе [Настройка региона по умолчанию для {% data variables.product.prodname_github_codespaces %}](/codespaces/customizing-your-codespace/setting-your-default-region-for-github-codespaces).

   {% endnote %}

1. При необходимости в разделе **Журнал шаблонов** укажите количество сохраняемых версий предварительной сборки. Можно ввести любое число от 1 до 5. Число сохраненных версий по умолчанию равно 2. Это означает, что сохраняются только последняя предварительная сборка и предыдущая версия.

   ![Параметр журнала предварительной сборки](/assets/images/help/codespaces/prebuilds-template-history-setting.png)

   В зависимости от параметров триггера предварительной сборки предварительная сборка может изменяться при каждой отправке или при каждом изменении конфигурации контейнера разработки. Сохранение более старых версий предварительной сборки позволяет создать предварительную сборку из более старой фиксации с другой конфигурацией контейнера разработки, отличной от текущей предварительной сборки. Этот параметр позволяет задать количество сохраненных версий на уровне, соответствующем вашим потребностям. 

   Если задать для сохранения число версий предварительной сборки равным 1, {% data variables.product.prodname_github_codespaces %} сохранит только последнюю версию предварительной сборки и удалит старую версию при каждом обновлении шаблона. Это означает, что вы не получите предварительно созданное пространство кода, если вернетесь к более старой конфигурации контейнера разработки.
   
   С каждой сохраненной версией предварительной сборки связаны затраты на хранилище. Например, если вы создаете предварительные сборки в 4 регионах и сохраняете 2 версии, с вас будет взиматься плата за хранение до 8 предварительных сборок. Дополнительные сведения о выставлении счетов см. в статье [Сведения о выставлении счетов за {% data variables.product.prodname_github_codespaces %}](/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces#codespaces-pricing).

1. При необходимости добавьте пользователей или команды, которые будут получать уведомления при сбое запусков рабочего процесса предварительной сборки для этой конфигурации. Начните вводить имя пользователя, имя команды или полное имя, а затем щелкните его, когда оно появится, чтобы добавить в список. Добавленные пользователи и команды будут получать сообщения электронной почты при сбое предварительной сборки. В сообщении будет содержаться ссылка на журналы выполнения рабочего процесса для изучения проблемы.

   ![Параметр уведомления о сбое предварительной сборки](/assets/images/help/codespaces/prebuilds-failure-notification-setting.png)

1. При необходимости в нижней части страницы щелкните **Показать дополнительные параметры**.

   ![Снимок экрана: страница конфигурации предварительной сборки с выделенным элементом "Показать дополнительные параметры"](/assets/images/help/codespaces/show-advanced-options.png)

   Если в разделе "Дополнительные параметры" выбрать **Отключить оптимизацию предварительной сборки**, codespace будут созданы без предварительной сборки, если последний рабочий процесс предварительной сборки завершился сбоем или выполняется в данный момент. Дополнительные сведения см. в разделе [Устранение неполадок с предварительными сборками](/codespaces/troubleshooting/troubleshooting-prebuilds#preventing-out-of-date-prebuilds-being-used).

1. Нажмите кнопку **Создать**.

   {% data reusables.codespaces.prebuilds-permission-authorization %}

После создания конфигурации предварительной сборки она отображается на странице {% data variables.product.prodname_github_codespaces %} параметров репозитория. Рабочий процесс {% data variables.product.prodname_actions %} помещается в очередь, а затем выполняется, чтобы создать предварительные сборки в указанных регионах на основе ветви и файла конфигурации контейнера разработки, которые вы выбрали. 

![Снимок экрана: список конфигураций предварительной сборки](/assets/images/help/codespaces/prebuild-configs-list.png)

Сведения об изменении и удалении конфигураций предварительной сборки см. в статье "[Управление предварительными сборками](/codespaces/prebuilding-your-codespaces/managing-prebuilds)".

## Настройка переменных среды

Чтобы разрешить процессу предварительной сборки доступ к переменным среды, необходимым для создания среды разработки, их можно задать как секреты репозитория {% data variables.product.prodname_codespaces %} или как секреты организации {% data variables.product.prodname_codespaces %}. Дополнительные сведения см. в разделе [Добавление секретов для репозитория](/codespaces/managing-codespaces-for-your-organization/managing-encrypted-secrets-for-your-repository-and-organization-for-github-codespaces#adding-secrets-for-a-repository) и [Добавление секретов для организации](/codespaces/managing-codespaces-for-your-organization/managing-encrypted-secrets-for-your-repository-and-organization-for-github-codespaces#adding-secrets-for-an-organization). 

Созданные таким образом секреты будут доступны любому пользователю, который создаст среду codespace из этого репозитория. Если этого не требуется, можно также задать секрет `CODESPACES_PREBUILD_TOKEN`. Секрет `CODESPACES_PREBUILD_TOKEN` используется только для предварительной сборки, а его значение недоступно в пространствах кода пользователей. 

Предварительные сборки не могут использовать секреты на уровне пользователя во время создания среды, поскольку такие секреты недоступны, пока не будет создана среда codespace.

## Настройка трудоемких задач для включения в предварительную сборку

Команды `onCreateCommand` и `updateContentCommand` можно использовать в `devcontainer.json` для включения длительных процессов в процесс создания предварительной сборки. Дополнительные сведения см. в документации по {% data variables.product.prodname_vscode %}, [devcontainer.json reference](https://code.visualstudio.com/docs/remote/devcontainerjson-reference#_lifecycle-scripts).

`onCreateCommand` выполняется только один раз при создании предварительной сборки `updateContentCommand` , в то время как выполняется при создании предварительной сборки и при последующих обновлениях. Добавочные сборки должны быть включены в `updateContentCommand`, так как они представляют источник проекта и должны быть включены для каждого обновления предварительной сборки.

## Дополнительные материалы

- "[Предоставление предварительной сборке доступа к другим репозиториям](/codespaces/prebuilding-your-codespaces/allowing-a-prebuild-to-access-other-repositories)"
- [Устранение неполадок с предварительными сборками](/codespaces/troubleshooting/troubleshooting-prebuilds)
